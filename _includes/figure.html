{% if include.width %}
  {% assign width = include.width %}
{% else %}
  {% assign width = "100" %}
{% endif %}

{% comment %} Choose which width to use for the standard 'src' (e.g., 800) {% endcomment %}
{% assign img_width = "-800" %}
{% assign img_ext = ".webp" %}

{% if include.images %}
  <div class="img-row">
    {% for image in include.images %}
      <div class="img-col-{{ image.width | default: width | divided_by: 8.33 | round }}">
        {% comment %} Logic to transform 'path/image.png' -> 'path/image-800.webp' {% endcomment %}
        {% assign base_path = image.path | split: "." | first %}
        {% assign optimized_path = base_path | append: img_width | append: img_ext %}

        <img class="img-fluid zoom" 
             src="{{ optimized_path | relative_url }}" 
             data-zoom-src="{{ image.path | relative_url }}" 
             alt="{{ image.alt | default: '' }}"
             onerror="this.onerror=null; this.src='{{ image.path | relative_url }}';">
        {% if image.caption %}
        <div class="caption">{{ image.caption }}</div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="img-row">
    <div class="img-col-{{ width | divided_by: 8.33 | round }}">
      {% assign base_path = include.path | split: "." | first %}
      {% assign optimized_path = base_path | append: img_width | append: img_ext %}

      <img class="img-fluid zoom" 
           src="{{ optimized_path | relative_url }}" 
           data-zoom-src="{{ include.path | relative_url }}" 
           alt="{{ include.alt | default: '' }}"
           onerror="this.onerror=null; this.src='{{ include.path | relative_url }}';">
      {% if include.caption %}
      <div class="caption">{{ include.caption }}</div>
      {% endif %}
    </div>
  </div>
{% endif %}